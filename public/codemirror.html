<html>
<title>Codemirror </title>
    <head>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.1/css/bootstrap.min.css" integrity="sha512-Z/def5z5u2aR89OuzYcxmDJ0Bnd5V1cKqBEbvLOiUNWdg9PQeXVvXLI90SE4QOHGlfLqUnDNVAYyZi8UwUTmWQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
        <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.1/js/bootstrap.min.js" integrity="sha512-fHY2UiQlipUq0dEabSM4s+phmn+bcxSYzXP4vAXItBvBHU7zAM/mkhCZjtBEIJexhOMzZbgFlPLuErlJF2b+0g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.32.0/codemirror.min.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.32.0/theme/dracula.min.css" integrity="sha512-AQKyjzgDAVIbGfhs+ytEbzDVPpv/nVC73/KXz2LlMAD195Fob07lxPCvOZD7I1DWj6QtQ0+B5DzXd04QbQgL3Q==" crossorigin="anonymous" referrerpolicy="no-referrer" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/addon/hint/show-hint.min.css" integrity="sha512-OmcLQEy8iGiD7PSm85s06dnR7G7C9C0VqahIPAj/KHk5RpOCmnC6R2ob1oK4/uwYhWa9BF1GC6tzxsC8TIx7Jg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/theme/blackboard.min.css" integrity="sha512-KnHAkH0/78Cyjs1tjV9/+00HK8gu1uKRCCKcWFxX0+rehRh9SYJqiG/2fY4St7H8rPItOsBkgQjN0m4rL5Wobw==" crossorigin="anonymous" referrerpolicy="no-referrer" />

        <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/codemirror.min.js" integrity="sha512-8RnEqURPUc5aqFEN04aQEiPlSAdE0jlFS/9iGgUyNtwFnSKCXhmB6ZTNl7LnDtDWKabJIASzXrzD0K+LYexU9g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/addon/hint/css-hint.min.js" integrity="sha512-1BD3lo262s+DtDFoeD8+ssEL1zVJU8SHWWMtUyxfLqMV/jQDEnyQlS/CL3mD1kkLSv2hhYq1sdcA/zAPDz4JVA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/addon/hint/show-hint.min.js" integrity="sha512-yhmeAerubMLaGAsyS7sE8Oqub6GeTkBDQpkXo2JKHgg7JOCudQvcbDQc5rPxdl7MqcDusTJzSy+ODlyzAwETfQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/addon/hint/javascript-hint.min.js" integrity="sha512-omIxBxPdObb7b3giwJtPBiB86Mey/ds7qyKFcRiaLQgDxoSR+UgCYEFO7jRZzPOCZAICabGCraEhOSa71U1zFA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/mode/javascript/javascript.min.js" integrity="sha512-I6CdJdruzGtvDyvdO4YsiAq+pkWf2efgd1ZUSK2FnM/u2VuRASPC7GowWQrWyjxCZn6CT89s3ddGI+be0Ak9Fg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/mode/textile/textile.min.js" integrity="sha512-iU4ig8FhJ7cz3klBOjjfqv1zAY2sqgTnye+6mxxa0lEZ4ZHuuRXGRd1jo6eEHlwoh91gq0pPDCaIR98m5tkKXg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/addon/search/searchcursor.min.js" integrity="sha512-+ZfZDC9gi1y9Xoxi9UUsSp+5k+AcFE0TRNjI0pfaAHQ7VZTaaoEpBZp9q9OvHdSomOze/7s5w27rcsYpT6xU6g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    </head>    
    <body>
        <textarea id=”editor”></textarea>
        <button id="btnGetdb">Obtener DB</button>
    </body>
    <script type="module">
        //import {syntaxTree} from "https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.32.0/codemirror.min.js"
        let btnGetdb = $("#btnGetdb");

        function myCompletions(context) {
            let word = context.matchBefore(/\w*/)
            if (word.from == word.to && !context.explicit)
            return null
            return {
            from: word.from,
            options: [
                {label: "match", type: "keyword"},
                {label: "hello", type: "variable", info: "(World)"},
                {label: "magic", type: "text", apply: "⠁⭒*.✩.*⭒⠁", detail: "macro"}
            ]
            }
        }
       
        function getDb(txt){
            let regStrDatabase = "(?=^|\n){1}[\t][a-z]+(([\n]+\t\t[a-zA-Z0-9\_]+)|([\n]+\t\t\t[a-zA-Z\_\[\]]+\:[a-zA-Z0-9\_\[\]\|/.]+)+)+";
            //let regStrTables = "(((?=\n)+\t\t[a-zA-Z0-9\_]+)|([\n]+\t\t\t[a-zA-Z\_\[\]]+\:[a-zA-Z0-9\_\[\]\|/.]+)+)+";
            let regStrTables = "(((?=^|\n){1}\t\t[a-zA-Z0-9 \_]+)|([\n]+\t\t\t[a-zA-Z \_\[\]]+\:[a-zA-Z0-9 \_\[\]\|/.]+)+)+";
            let regDb = new RegExp(regStrDatabase,"gm");
            let regTable = new RegExp(regStrTables,"gm");
            console.log(txt.match(regDb,txt));
            console.log(txt.match(regTable,txt));
        }
        btnGetdb.click((event) => {
            getDb(editor.getValue());
        });
        
        console.log(CodeMirror);
        /*let cm = new CodeMirror.fromTextArea(document.getElementById("editor"), {
            lineNumbers: true, 
            mode: "javascript", 
            lineWrapping: false
        });*/
     /*   myLanguage.data.of({
            autocomplete: myCompletions
          })*/

       /* javascript.data.of({
            autocomplete: myCompletions
        })*/

        var editor = CodeMirror(document.body, {
            value: "function myScript(){return 100;}\n",
            mode:  "text",
            theme: 'blackboard',
                                    
        /*    extraKeys: {
                "Ctrl-Space": function(cm) {
                    console.log("press");
                    cm.execCommand("autocomplete")
                },
                "Esc": function(cm) {
                    if (cm.getOption("fullScreen")) cm.setOption("fullScreen", false);
                },
                "Ctrl-S": function(instance) { 
                    $("#myform").submit();
                },
            },*/
            //lineWrapping: true,
            lineNumbers: true,
            lineWrapping: false,
            styleActiveLine: true,
            //matchBrackets: true,
          });


        
        var arrows = [37, 38, 39, 40]
                
        editor.on("keyup", function(cm, e) {
        if (arrows.indexOf(e.keyCode) < 0) {
            editor.execCommand("autocomplete")
        }
        })
    </script>
</html>